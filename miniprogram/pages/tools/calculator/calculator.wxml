<!--calculator.wxml-->
<view class="calculator-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-title">
      <text class="title-text">è®¡ç®—å™¨</text>
    </view>
    <view class="header-actions">
      <view class="favorite-btn {{isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
        <text class="favorite-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      </view>
    </view>
  </view>

  <!-- æ˜¾ç¤ºå±åŒºåŸŸ -->
  <view class="display-section">
    <!-- å†å²è¡¨è¾¾å¼ -->
    <view class="expression-display">
      <text class="expression-text">{{expression}}</text>
    </view>
    
    <!-- å½“å‰ç»“æœ -->
    <view class="result-display">
      <text class="result-text">{{result}}</text>
      <view wx:if="{{result && result !== '0'}}" class="copy-btn" bindtap="onCopyResult">
        <icon type="download" size="16"></icon>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½åˆ‡æ¢ -->
  <view class="mode-switch">
    <view 
      class="mode-btn {{mode === 'basic' ? 'active' : ''}}"
      bindtap="onSwitchMode"
      data-mode="basic"
    >
      åŸºç¡€
    </view>
    <view 
      class="mode-btn {{mode === 'scientific' ? 'active' : ''}}"
      bindtap="onSwitchMode"
      data-mode="scientific"
    >
      ç§‘å­¦
    </view>
    <view 
      class="mode-btn"
      bindtap="onShowHistory"
    >
      å†å²
    </view>
  </view>

  <!-- åŸºç¡€è®¡ç®—å™¨æŒ‰é”® -->
  <view wx:if="{{mode === 'basic'}}" class="keypad basic-keypad">
    <!-- ç¬¬ä¸€è¡Œï¼šæ¸…é™¤ã€åˆ é™¤ã€ç™¾åˆ†å·ã€é™¤æ³• -->
    <view class="keypad-row">
      <view class="key function-key" bindtap="onKeyTap" data-key="clear">C</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="backspace">âŒ«</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="%">%</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="/">Ã·</view>
    </view>
    
    <!-- ç¬¬äºŒè¡Œï¼š7ã€8ã€9ã€ä¹˜æ³• -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="7">7</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="8">8</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="9">9</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="*">Ã—</view>
    </view>
    
    <!-- ç¬¬ä¸‰è¡Œï¼š4ã€5ã€6ã€å‡æ³• -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="4">4</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="5">5</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="6">6</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="-">-</view>
    </view>
    
    <!-- ç¬¬å››è¡Œï¼š1ã€2ã€3ã€åŠ æ³• -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="1">1</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="2">2</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="3">3</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="+">+</view>
    </view>
    
    <!-- ç¬¬äº”è¡Œï¼š0ã€å°æ•°ç‚¹ã€ç­‰å· -->
    <view class="keypad-row">
      <view class="key number-key zero-key" bindtap="onKeyTap" data-key="0">0</view>
      <view class="key number-key" bindtap="onKeyTap" data-key=".">.</view>
      <view class="key equals-key" bindtap="onKeyTap" data-key="=">=</view>
    </view>
  </view>

  <!-- ç§‘å­¦è®¡ç®—å™¨æŒ‰é”® -->
  <view wx:elif="{{mode === 'scientific'}}" class="keypad scientific-keypad">
    <!-- ç¬¬ä¸€è¡Œï¼šç§‘å­¦å‡½æ•° -->
    <view class="keypad-row">
      <view class="key function-key" bindtap="onKeyTap" data-key="sin">sin</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="cos">cos</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="tan">tan</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="ln">ln</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="log">log</view>
    </view>
    
    <!-- ç¬¬äºŒè¡Œï¼šæ›´å¤šç§‘å­¦å‡½æ•° -->
    <view class="keypad-row">
      <view class="key function-key" bindtap="onKeyTap" data-key="sqrt">âˆš</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="pow">xÂ²</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="exp">eË£</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="pi">Ï€</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="e">e</view>
    </view>
    
    <!-- ç¬¬ä¸‰è¡Œï¼šæ‹¬å·å’ŒåŸºç¡€æ“ä½œ -->
    <view class="keypad-row">
      <view class="key function-key" bindtap="onKeyTap" data-key="(">(</view>
      <view class="key function-key" bindtap="onKeyTap" data-key=")">)</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="clear">C</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="backspace">âŒ«</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="/">Ã·</view>
    </view>
    
    <!-- ç¬¬å››è¡Œï¼šæ•°å­—å’Œè¿ç®—ç¬¦ -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="7">7</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="8">8</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="9">9</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="*">Ã—</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="%">%</view>
    </view>
    
    <!-- ç¬¬äº”è¡Œï¼šæ•°å­—å’Œè¿ç®—ç¬¦ -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="4">4</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="5">5</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="6">6</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="-">-</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="1/x">1/x</view>
    </view>
    
    <!-- ç¬¬å…­è¡Œï¼šæ•°å­—å’Œè¿ç®—ç¬¦ -->
    <view class="keypad-row">
      <view class="key number-key" bindtap="onKeyTap" data-key="1">1</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="2">2</view>
      <view class="key number-key" bindtap="onKeyTap" data-key="3">3</view>
      <view class="key operator-key" bindtap="onKeyTap" data-key="+">+</view>
      <view class="key function-key" bindtap="onKeyTap" data-key="x!">x!</view>
    </view>
    
    <!-- ç¬¬ä¸ƒè¡Œï¼š0ã€å°æ•°ç‚¹ã€ç­‰å· -->
    <view class="keypad-row">
      <view class="key number-key zero-key" bindtap="onKeyTap" data-key="0">0</view>
      <view class="key number-key" bindtap="onKeyTap" data-key=".">.</view>
      <view class="key equals-key" bindtap="onKeyTap" data-key="=">=</view>
    </view>
  </view>
</view>

<!-- å†å²è®°å½•å¼¹çª— -->
<view wx:if="{{showHistory}}" class="history-modal" bindtap="onHideHistory">
  <view class="history-content" catchtap="stopPropagation">
    <view class="history-header">
      <text class="history-title">è®¡ç®—å†å²</text>
      <view class="history-actions">
        <text class="clear-history" bindtap="onClearHistory">æ¸…ç©º</text>
        <text class="close-history" bindtap="onHideHistory">å…³é—­</text>
      </view>
    </view>
    
    <scroll-view class="history-list" scroll-y>
      <view wx:if="{{history.length === 0}}" class="empty-history">
        <text>æš‚æ— è®¡ç®—å†å²</text>
      </view>
      <view 
        wx:for="{{history}}" 
        wx:key="id"
        class="history-item"
        bindtap="onSelectHistory"
        data-item="{{item}}"
      >
        <view class="history-expression">{{item.expression}}</view>
        <view class="history-result">= {{item.result}}</view>
        <view class="history-time">{{item.time}}</view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- åŠ è½½ç»„ä»¶ -->
<loading show="{{isLoading}}" text="{{loadingText}}"></loading> 