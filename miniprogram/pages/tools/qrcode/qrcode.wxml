<!--qrcode.wxml-->
<view class="qrcode-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">äºŒç»´ç å·¥å…·</text>
    <view class="favorite-btn {{isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
      {{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}
    </view>
  </view>

  <!-- åŠŸèƒ½åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === 'generate' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="generate"
    >
      <view class="tab-icon">ğŸ“±</view>
      <text class="tab-text">ç”ŸæˆäºŒç»´ç </text>
    </view>
    <view 
      class="tab-item {{currentTab === 'scan' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="scan"
    >
      <view class="tab-icon">ğŸ“·</view>
      <text class="tab-text">æ‰«æäºŒç»´ç </text>
    </view>
    <view 
      class="tab-item {{currentTab === 'history' ? 'active' : ''}}"
      bindtap="onTabChange"
      data-tab="history"
    >
      <view class="tab-icon">ğŸ“‹</view>
      <text class="tab-text">å†å²è®°å½•</text>
    </view>
  </view>

  <!-- ç”ŸæˆäºŒç»´ç  -->
  <view wx:if="{{currentTab === 'generate'}}" class="generate-section">
    <!-- å†…å®¹ç±»å‹é€‰æ‹© -->
    <view class="content-type">
      <view class="type-header">
        <text class="section-title">å†…å®¹ç±»å‹</text>
      </view>
      <view class="type-buttons">
        <view 
          wx:for="{{contentTypes}}" 
          wx:key="id"
          class="type-btn {{contentType === item.id ? 'active' : ''}}"
          bindtap="onContentTypeChange"
          data-type="{{item.id}}"
        >
          <view class="type-btn-icon">{{item.icon}}</view>
          <text class="type-btn-text">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- å†…å®¹è¾“å…¥ -->
    <view class="content-input">
      <view class="input-header">
        <text class="section-title">{{contentTypes[contentTypeIndex].inputLabel}}</text>
        <text class="char-count">{{inputContent.length}}/{{maxLength}}</text>
      </view>
      
      <textarea
        class="content-textarea"
        placeholder="{{contentTypes[contentTypeIndex].placeholder}}"
        value="{{inputContent}}"
        bindinput="onContentInput"
        maxlength="{{maxLength}}"
        auto-height
        show-confirm-bar="{{false}}"
      ></textarea>
      
      <!-- å¿«æ·è¾“å…¥ -->
      <view wx:if="{{quickInputs.length > 0}}" class="quick-inputs">
        <text class="quick-title">å¿«æ·è¾“å…¥</text>
        <view class="quick-list">
          <view 
            wx:for="{{quickInputs}}" 
            wx:key="id"
            class="quick-item"
            bindtap="onQuickInput"
            data-content="{{item.content}}"
          >
            {{item.label}}
          </view>
        </view>
      </view>
    </view>

    <!-- ç”ŸæˆæŒ‰é’® -->
    <view class="generate-actions">
      <button 
        class="generate-btn {{inputContent ? 'active' : ''}}"
        bindtap="onGenerateQR"
        disabled="{{!inputContent || isGenerating}}"
      >
        <text wx:if="{{!isGenerating}}">ç”ŸæˆäºŒç»´ç </text>
        <text wx:else>ç”Ÿæˆä¸­...</text>
      </button>
    </view>

    <!-- äºŒç»´ç æ˜¾ç¤º -->
    <view wx:if="{{qrCodeUrl}}" class="qrcode-display">
      <view class="qrcode-header">
        <text class="section-title">äºŒç»´ç </text>
        <view class="qrcode-actions">
          <view class="action-btn" bindtap="onSaveQR">
            <icon type="download" size="16"></icon>
            <text>ä¿å­˜</text>
          </view>
          <view class="action-btn" bindtap="onShareQR">
            <icon type="download" size="16"></icon>
            <text>åˆ†äº«</text>
          </view>
        </view>
      </view>
      
      <view class="qrcode-wrapper">
        <image 
          class="qrcode-image"
          src="{{qrCodeUrl}}"
          mode="aspectFit"
          bindlongpress="onLongPressQR"
        ></image>
      </view>
      
      <view class="qrcode-info">
        <text class="qrcode-content">{{displayContent}}</text>
        <text class="qrcode-time">ç”Ÿæˆæ—¶é—´ï¼š{{generateTime}}</text>
      </view>
    </view>
  </view>

  <!-- æ‰«æäºŒç»´ç  -->
  <view wx:if="{{currentTab === 'scan'}}" class="scan-section">
    <view class="scan-intro">
      <view class="scan-icon">ğŸ“·</view>
      <text class="scan-title">æ‰«æäºŒç»´ç </text>
      <text class="scan-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ‰«æäºŒç»´ç </text>
    </view>
    
    <view class="scan-actions">
      <button class="scan-btn" bindtap="onStartScan">
        <icon type="download" size="20"></icon>
        <text>å¼€å§‹æ‰«æ</text>
      </button>
    </view>
    
    <!-- æ‰«æç»“æœ -->
    <view wx:if="{{scanResult}}" class="scan-result">
      <view class="result-header">
        <text class="section-title">æ‰«æç»“æœ</text>
        <view class="result-actions">
          <view class="action-btn" bindtap="onCopyScanResult">
            <icon type="download" size="16"></icon>
            <text>å¤åˆ¶</text>
          </view>
          <view wx:if="{{scanResult.type === 'url'}}" class="action-btn" bindtap="onOpenUrl">
            <icon type="download" size="16"></icon>
            <text>æ‰“å¼€</text>
          </view>
        </view>
      </view>
      
      <view class="result-content">
        <view class="result-type">
          <text class="type-label">ç±»å‹ï¼š</text>
          <text class="type-value">{{scanResult.typeLabel}}</text>
        </view>
        <view class="result-text">
          <text class="content-label">å†…å®¹ï¼š</text>
          <text class="content-value">{{scanResult.content}}</text>
        </view>
        <text class="result-time">æ‰«ææ—¶é—´ï¼š{{scanResult.time}}</text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view wx:if="{{currentTab === 'history'}}" class="history-section">
    <view class="history-header">
      <text class="section-title">å†å²è®°å½•</text>
      <view wx:if="{{history.length > 0}}" class="history-actions">
        <view class="action-btn" bindtap="onClearHistory">
          <text>æ¸…ç©º</text>
        </view>
      </view>
    </view>
    
    <view wx:if="{{history.length === 0}}" class="empty-history">
      <view class="empty-icon">ğŸ“‹</view>
      <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
      <text class="empty-desc">ç”Ÿæˆæˆ–æ‰«æäºŒç»´ç åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    </view>
    
    <scroll-view wx:else scroll-y class="history-list">
      <view 
        wx:for="{{history}}" 
        wx:key="id"
        class="history-item"
        bindtap="onSelectHistory"
        data-item="{{item}}"
      >
        <view class="history-main">
          <view class="history-type">
            <view class="type-badge {{item.action}}">{{item.actionLabel}}</view>
            <text class="content-type">{{item.typeLabel}}</text>
          </view>
          <view class="history-content">
            <text class="content-preview">{{item.contentPreview}}</text>
          </view>
          <text class="history-time">{{item.time}}</text>
        </view>
        
        <view class="history-actions">
          <view class="history-action" bindtap="onHistoryAction" data-action="copy" data-item="{{item}}">
            <icon type="download" size="14"></icon>
          </view>
          <view wx:if="{{item.action === 'generate'}}" class="history-action" bindtap="onHistoryAction" data-action="regenerate" data-item="{{item}}">
            <icon type="download" size="14"></icon>
          </view>
          <view class="history-action" bindtap="onHistoryAction" data-action="delete" data-item="{{item}}">
            <icon type="download" size="14"></icon>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>

<!-- åŠ è½½ç»„ä»¶ -->
<loading show="{{isLoading}}" text="{{loadingText}}"></loading> 