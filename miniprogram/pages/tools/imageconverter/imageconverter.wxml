<!--imageconverter.wxml-->
<view class="image-converter-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-title">
      <text class="title-text">å›¾ç‰‡è½¬æ¢</text>
      <text class="title-desc">å›¾ç‰‡æ ¼å¼è½¬æ¢å’Œå¤„ç†å·¥å…·</text>
    </view>
    <view class="header-actions">
      <view class="favorite-btn {{isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
        <text class="favorite-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      </view>
    </view>
  </view>

  <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
  <view class="upload-section">
    <view wx:if="{{!currentImage}}" class="upload-area" bindtap="onChooseImage">
      <view class="upload-icon">ğŸ“·</view>
      <text class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡</text>
      <text class="upload-desc">æ”¯æŒä»ç›¸å†Œé€‰æ‹©æˆ–æ‹ç…§</text>
    </view>
    
    <view wx:else class="image-preview">
      <image class="preview-image" src="{{currentImage.path}}" mode="aspectFit"></image>
      <view class="image-info">
        <text class="info-text">{{currentImage.name}}</text>
        <text class="info-text">{{currentImage.width}}Ã—{{currentImage.height}}</text>
        <text class="info-text">{{currentImage.format}} Â· {{currentImage.sizeText}}</text>
      </view>
      <button class="change-image-btn" bindtap="onChooseImage">æ›´æ¢å›¾ç‰‡</button>
    </view>
  </view>

  <!-- åŠŸèƒ½é€‰é¡¹åŒºåŸŸ -->
  <view wx:if="{{currentImage}}" class="options-section">
    <view class="option-tabs">
      <view 
        wx:for="{{conversionOptions}}" 
        wx:key="id"
        class="option-tab {{currentOption === item.id ? 'active' : ''}}"
        bindtap="onOptionChange"
        data-option="{{item.id}}"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
      </view>
    </view>

    <!-- æ ¼å¼è½¬æ¢é€‰é¡¹ -->
    <view wx:if="{{currentOption === 'format'}}" class="format-options">
      <view class="option-group">
        <text class="group-title">è¾“å‡ºæ ¼å¼</text>
        <view class="format-list">
          <view 
            class="format-item {{outputFormat === 'jpg' ? 'selected' : ''}}"
            bindtap="onFormatChange"
            data-format="jpg"
          >
            <text class="format-text">JPG</text>
          </view>
          <view 
            class="format-item {{outputFormat === 'png' ? 'selected' : ''}}"
            bindtap="onFormatChange"
            data-format="png"
          >
            <text class="format-text">PNG</text>
          </view>
        </view>
      </view>
      
      <view wx:if="{{outputFormat === 'jpg'}}" class="option-group">
        <text class="group-title">å›¾ç‰‡è´¨é‡: {{outputQuality}}%</text>
        <slider 
          class="quality-slider"
          min="10" 
          max="100" 
          value="{{outputQuality}}"
          bindchange="onQualityChange"
          show-value="{{false}}"
        ></slider>
      </view>
    </view>

    <!-- è£å‰ªé€‰é¡¹ -->
    <view wx:if="{{currentOption === 'crop'}}" class="crop-options">
      <view class="option-group">
        <text class="group-title">è£å‰ªæ¯”ä¾‹</text>
        <view class="crop-ratios">
          <view 
            wx:for="{{cropRatios}}" 
            wx:key="id"
            class="crop-ratio {{selectedCropRatio === item.id ? 'selected' : ''}}"
            bindtap="onCropRatioChange"
            data-ratio="{{item.id}}"
          >
            <text class="ratio-text">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å‹ç¼©é€‰é¡¹ -->
    <view wx:if="{{currentOption === 'compress'}}" class="compress-options">
      <view class="option-group">
        <text class="group-title">å‹ç¼©è´¨é‡: {{outputQuality}}%</text>
        <slider 
          class="quality-slider"
          min="10" 
          max="100" 
          value="{{outputQuality}}"
          bindchange="onQualityChange"
          show-value="{{false}}"
        ></slider>
      </view>
    </view>

    <!-- é‡å‘½åé€‰é¡¹ -->
    <view wx:if="{{currentOption === 'rename'}}" class="rename-options">
      <view class="option-group">
        <text class="group-title">æ–‡ä»¶åç§°</text>
        <input 
          class="name-input"
          value="{{outputFileName}}"
          placeholder="è¯·è¾“å…¥æ–‡ä»¶å"
          bindinput="onFileNameInput"
        />
      </view>
    </view>

    <!-- å¤„ç†æŒ‰é’® -->
    <view class="action-section">
      <button 
        class="process-btn"
        bindtap="onProcessImage"
        disabled="{{isLoading}}"
      >
        {{isLoading ? loadingText : 'å¼€å§‹å¤„ç†'}}
      </button>
    </view>
  </view>

  <!-- å¤„ç†ç»“æœåŒºåŸŸ -->
  <view wx:if="{{processedImage}}" class="result-section">
    <view class="result-header">
      <text class="result-title">å¤„ç†ç»“æœ</text>
    </view>
    
    <view class="result-preview">
      <image class="result-image" src="{{processedImage.path}}" mode="aspectFit"></image>
      <view class="result-info">
        <text class="info-text">{{processedImage.name}}</text>
        <text class="info-text">{{processedImage.width}}Ã—{{processedImage.height}}</text>
        <text class="info-text">{{processedImage.format}} Â· {{processedImage.sizeText}}</text>
      </view>
    </view>

    <view class="result-actions">
      <button class="save-btn" bindtap="onSaveToAlbum">ä¿å­˜åˆ°ç›¸å†Œ</button>
      <button class="reset-btn" bindtap="onResetImage">é‡æ–°å¤„ç†</button>
    </view>
  </view>

  <!-- å†å²è®°å½•åŒºåŸŸ -->
  <view wx:if="{{history.length > 0}}" class="history-section">
    <view class="history-header">
      <text class="history-title">å¤„ç†å†å²</text>
      <button class="clear-history-btn" bindtap="onClearHistory">æ¸…ç©º</button>
    </view>
    
    <view class="history-list">
      <view 
        wx:for="{{history}}" 
        wx:key="id"
        class="history-item"
      >
        <view class="history-info">
          <text class="history-operation">{{item.operation}}</text>
          <text class="history-time">{{item.time}}</text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- éšè—çš„Canvasç”¨äºå›¾ç‰‡å¤„ç† -->
<canvas 
  id="imageCanvas"
  canvas-id="imageCanvas" 
  type="2d"
  style="position: fixed; top: -9999px; left: -9999px; width: 1px; height: 1px;"
></canvas>

<!-- åŠ è½½ç»„ä»¶ -->
<loading show="{{isLoading}}" text="{{loadingText}}"></loading> 